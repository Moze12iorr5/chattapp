<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Welcome OmeStarChat</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 700px; margin: 20px auto; }
    nav a { margin: 0 10px; }
    #messages { list-style-type: none; padding: 0; height: 300px; overflow-y: scroll; border: 1px solid #ccc; }
    #messages li { padding: 5px; border-bottom: 1px solid #eee; }
    #messages li img { max-width: 150px; max-height: 150px; }
  </style>
</head>
<body>
  <nav>
    <a href="/">Chat</a> | 
    <a href="/about">About</a> | 
    <a href="/faq">FAQ</a> | 
    <a href="/rules">Rules</a> | 
    <a href="/contact">Contact</a>
  </nav>

  <h1>Welcome OmeStarChat</h1>

  <ul id="messages"></ul>

  <input id="input" autocomplete="off" placeholder="Type message here..." />
  <button id="sendBtn">Send</button>

  <hr>

  <input type="file" id="imageInput" accept="image/*" />
  <button id="uploadBtn">Upload Image</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    let username = '';
    while(!username) {
      username = prompt('Enter your username:').trim();
    }

    socket.emit('join', username);

    socket.on('banned', () => {
      alert('You are banned from this chat.');
      window.location.reload();
    });

    const input = document.getElementById('input');
    const sendBtn = document.getElementById('sendBtn');
    const messages = document.getElementById('messages');
    const imageInput = document.getElementById('imageInput');
    const uploadBtn = document.getElementById('uploadBtn');

    sendBtn.onclick = () => {
      const text = input.value.trim();
      if(text) {
        socket.emit('chat message', text);
        input.value = '';
      }
    };

    input.addEventListener('keypress', e => {
      if(e.key === 'Enter') sendBtn.click();
    });

    socket.on('chat message', (msg) => {
      const li = document.createElement('li');
      li.textContent = `${msg.user}: ${msg.text}`;
      messages.appendChild(li);
      messages.scrollTop = messages.scrollHeight;
    });

    socket.on('chat image', (msg) => {
      const li = document.createElement('li');
      li.innerHTML = `${msg.user}: <br><img src="${msg.url}" alt="uploaded image"/>`;
      messages.appendChild(li);
      messages.scrollTop = messages.scrollHeight;
    });

    uploadBtn.onclick = () => {
      const file = imageInput.files[0];
      if(!file) return alert('Please select an image');

      const reader = new FileReader();
      reader.onload = (e) => {
        socket.emit('image upload', { image: e.target.result, filename: file.name });
      };
      reader.readAsDataURL(file);
    };

    // For admin to ban users â€” just a prompt, can be improved
    window.banUser = () => {
      if(username !== 'admin') {
        alert('You are not admin');
        return;
      }
      const userToBan = prompt('Enter username to ban:');
      if(userToBan) {
        socket.emit('ban user', userToBan);
      }
    };

    socket.on('user banned', (bannedName) => {
      const li = document.createElement('li');
      li.style.color = 'red';
      li.textContent = `User banned: ${bannedName}`;
      messages.appendChild(li);
    });

  </script>

  <button onclick="banUser()">Ban User (Admin only)</button>
</body>
</html>

